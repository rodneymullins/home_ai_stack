<!DOCTYPE html>
<html>

<head>
    <title>Cluster Trends</title>
    <!-- Styles included via base template or assumed global if linked -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/dashboard.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Text:wght@400;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.35.0.min.js"></script>
</head>

<body>
    <div class="container">
        <a href="/" class="back-btn"
            style="text-decoration: none; color: var(--bronze); font-size: 0.9em; display: inline-block; margin-bottom: 20px;">‚Üê
            Back to Dashboard</a>
        <h1 class="text-center mb-4" style="font-family: 'Cinzel', serif; color: var(--gold);">üìà Cluster Trends Over
            Time</h1>
        <p class="text-center" style="color: #888; margin-bottom: 30px;">
            Track how machines move between clusters over time
        </p>

        <div style="background: rgba(26, 26, 26, 0.95); padding: 20px; border-radius: 8px;">
            <div id="trends-chart" style="width: 100%; height: 600px;"></div>
        </div>

        <div class="card p-4 mt-4"
            style="background: linear-gradient(145deg, #1a1d23, #22262e); border: 1px solid rgba(212, 175, 55, 0.2);">
            <h3 style="color: var(--gold); font-family: 'Cinzel', serif;">üí° Understanding Cluster Trends</h3>
            <ul style="color: #aaa;">
                <li><strong>Rising Lines:</strong> More machines joining this cluster</li>
                <li><strong>Falling Lines:</strong> Machines moving to other clusters</li>
                <li><strong>Stable Lines:</strong> Consistent cluster membership</li>
                <li><strong>Snapshots:</strong> Taken weekly to track changes</li>
            </ul>

            <form method="POST" action="/analytics/save-cluster-snapshot" style="margin-top: 20px;">
                <button type="submit" class="btn"
                    style="background: var(--gold); color: #000; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                    üì∏ Save Current Snapshot
                </button>
            </form>
        </div>
    </div>

    <script>
        const traces = {{ traces| tojson }};

        const layout = {
            title: {
                text: 'Cluster Membership Over Time',
                font: { color: '#d4af37', size: 20, family: 'Cinzel' }
            },
            xaxis: {
                title: 'Date',
                gridcolor: 'rgba(255,255,255,0.1)',
                color: '#aaa'
            },
            yaxis: {
                title: 'Number of Machines',
                gridcolor: 'rgba(255,255,255,0.1)',
                color: '#aaa'
            },
            plot_bgcolor: 'rgba(26,26,26,0.5)',
            paper_bgcolor: 'rgba(26,26,26,0.5)',
            font: { color: '#f4e8d0' },
            legend: { bgcolor: 'rgba(26,26,26,0.8)' },
            hovermode: 'x unified'
        };

        Plotly.newPlot('trends-chart', traces, layout, { responsive: true, displayModeBar: false });
    </script>
</body>

</html>