<!-- System Metrics Widget -->
<!-- Add this to the dashboard HTML (The One Dashboard) -->

<div class="card mb-4">
    <div class="card-header">
        <h5>üñ•Ô∏è System Status</h5>
    </div>
    <div class="card-body">
        <div class="row" id="system-metrics">
            <!-- Populated by JavaScript -->
        </div>
    </div>
</div>

<script>
    // Fetch and display system metrics
    async function loadSystemMetrics() {
        try {
            const response = await fetch('/api/system-metrics');
            const data = await response.json();
            const metrics = data.metrics;

            let html = '';

            // Kalshi Bot P&L
            if (metrics.kalshi && !metrics.kalshi.error) {
                const pnlClass = metrics.kalshi.today_pnl >= 0 ? 'text-success' : 'text-danger';
                html += `
                <div class="col-md-4 mb-3">
                    <div class="metric-card">
                        <h6>üí∞ Kalshi Bot</h6>
                        <h3 class="${pnlClass}">$${metrics.kalshi.today_pnl.toFixed(2)}</h3>
                        <small>${metrics.kalshi.today_trades} trades today</small>
                        <div class="badge bg-${metrics.kalshi.status === 'active' ? 'success' : 'secondary'}">${metrics.kalshi.status}</div>
                    </div>
                </div>
            `;
            }

            // BitNet API Status
            if (metrics.bitnet) {
                const statusColor = metrics.bitnet.status === 'healthy' ? 'success' : 'danger';
                html += `
                <div class="col-md-4 mb-3">
                    <div class="metric-card">
                        <h6>ü§ñ BitNet XL API</h6>
                        <div class="badge bg-${statusColor}">${metrics.bitnet.status}</div>
                        <p class="mt-2 mb-0"><small>Uptime: ${metrics.bitnet.uptime || 'N/A'}</small></p>
                        <p class="mb-0"><small>Memory: ${metrics.bitnet.memory_mb || 0} MB</small></p>
                    </div>
                </div>
            `;
            }

            // Net Worth
            if (metrics.net_worth && !metrics.net_worth.error) {
                const changeClass = metrics.net_worth.change_7d >= 0 ? 'text-success' : 'text-danger';
                const arrow = metrics.net_worth.change_7d >= 0 ? '‚Üë' : '‚Üì';
                html += `
                <div class="col-md-4 mb-3">
                    <div class="metric-card">
                        <h6>üíé Net Worth</h6>
                        <h3>$${metrics.net_worth.current.toLocaleString()}</h3>
                        <small class="${changeClass}">
                            ${arrow} $${Math.abs(metrics.net_worth.change_7d).toFixed(2)} 
                            (${metrics.net_worth.change_pct.toFixed(1)}%) 7d
                        </small>
                    </div>
                </div>
            `;
            }

            // Storage Usage
            if (metrics.storage_hot) {
                html += `
                <div class="col-md-6 mb-3">
                    <div class="metric-card">
                        <h6>üíæ Storage - Hot Tier</h6>
                        <div class="progress mb-2">
                            <div class="progress-bar" style="width: ${metrics.storage_hot.percent}%">
                                ${metrics.storage_hot.percent}%
                            </div>
                        </div>
                        <small>${metrics.storage_hot.used} / ${metrics.storage_hot.total}</small>
                    </div>
                </div>
            `;
            }

            // Database Health
            if (metrics.database && metrics.database.status === 'healthy') {
                html += `
                <div class="col-md-6 mb-3">
                    <div class="metric-card">
                        <h6>üóÑÔ∏è Database</h6>
                        <div class="badge bg-success">healthy</div>
                        <p class="mt-2 mb-0"><small>Size: ${metrics.database.size_gb} GB</small></p>
                        <p class="mb-0"><small>Connections: ${metrics.database.connections}</small></p>
                    </div>
                </div>
            `;
            }

            document.getElementById('system-metrics').innerHTML = html;

        } catch (error) {
            console.error('Error loading system metrics:', error);
            document.getElementById('system-metrics').innerHTML =
                '<div class="col-12"><div class="alert alert-danger">Failed to load metrics</div></div>';
        }
    }

    // Load on page load
    loadSystemMetrics();

    // Refresh every 30 seconds
    setInterval(loadSystemMetrics, 30000);
</script>

<style>
    .metric-card {
        padding: 15px;
        background: rgba(212, 175, 55, 0.05);
        border: 1px solid rgba(212, 175, 55, 0.2);
        border-radius: 8px;
        text-align: center;
    }

    .metric-card h6 {
        color: var(--gold);
        margin-bottom: 10px;
    }

    .metric-card h3 {
        margin: 10px 0;
        font-size: 1.8em;
    }

    .metric-card .badge {
        margin-top: 5px;
    }
</style>